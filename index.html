<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Knote</title>
	<link rel="stylesheet" href="css/katex.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="css/main.css">
	
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<textarea id="tex" class="col-md-6 pane"></textarea>
			<div id="output" class="col-md-6 pane"></div>
		</div>
		<div class="row">
			<div id="render-row" class="col-md-12">
				<input type="button" id="render" value="Render">
			</div>
		</div>
	</div>

	<!-- SCRIPTS -->
	<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="js/jquery.hotkeys.js"></script>
	<script src="js/katex.min.js"></script>
	<script src="js/stmd.js"></script>

	<script>
		var writer = new stmd.HtmlRenderer();
		var reader = new stmd.DocParser();

		$(document).ready(function() {
			// utility function
			function strip(html)
			{
				var tmp = document.createElement("div");
				tmp.innerHTML = html;
				return tmp.textContent || tmp.innerText || "";
			}

			// set up an "on render" function
			var renderTex = function() {
				var math = document.getElementById("output");
				var input = $('#tex').val();

				localStorage.setItem("texData", input);
				input = writer.renderBlock(reader.parse(input)).split('$');

				var output = "";
				var isMath = false;

				for (var piece in input) {
					if (isMath) {
						output += katex.renderToString(strip(input[piece]));
					} else {
						output += input[piece];
					}
					isMath = !isMath;
				}

				$('#output').html(output);
			};

			// autofocus
			$('#tex').focus();
			
			// local storage
			var priorData = localStorage.getItem("texData");
			if (priorData)
			{
				$('#tex').val(priorData);
				renderTex();
			}

			// create bindings for rendering
			$('#render').click(renderTex);
			$(document).bind('keydown', 'ctrl+return', renderTex);
		});
	</script>
</body>
</html>