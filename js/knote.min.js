var writer=new stmd.HtmlRenderer,reader=new stmd.DocParser;$(document).ready(function(){function e(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}var t=function(){var e=c("1234");e!=$("#tex").val()&&($("#tex").val(c("1234")),l())},n=new Dropbox.Client({key:"7nj69doyzp49ge1"}),r=null;n.authenticate({interactive:!1},function(e){e&&alert("Authentication error: "+e)});var a=function(){n.isAuthenticated()&&($("#dropbox").css("display","none"),$("#app").css("display","block"))};a(),$("#dropbox-button").click(function(){n.authenticate({},function(e){e&&alert("Authentication error: "+e),a()})});var o=function(){console.log("Channels");var e=n.getDatastoreManager();e.openDefaultDatastore(function(e,n){e&&alert("Error opening default datastore: "+e),r=n,n.recordsChanged.addListener(function(){t()}),t()})};o();var i=function(e,t){if(null!==r){var n=r.getTable("notepads"),a=n.query({padname:e});if(a.length>0){var o=a[0];o.set("data",t)}else{n.insert({padname:e,data:t,created:new Date})}}},c=function(e){if(null===r)return"";var t=r.getTable("notepads"),n=t.query({padname:e});return n.length>0?n[0].get("data"):""},l=function(){$("#errors").css("display","none");var t=(document.getElementById("output"),$("#tex").val());i("1234",t),t=writer.renderBlock(reader.parse(t)).split("$");var n="",r=!1,a=!1;try{for(var o in t){if(""==t[o]&&(r=!r,a=!a),r){var c=katex.renderToString(e(t[o]));n+=a?'<div class="text-center">'+c+"</div>":c,a=!1}else n+=t[o];r=!r}$("#output").html(n)}catch(l){$("#errors").css("display","block"),$("#alert").html("<strong>Error!</strong> "+l.message)}};$("#tex").focus(),$("#render").click(l),$("#tex").bind("keydown","ctrl+return",l)});