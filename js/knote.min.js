var writer=new stmd.HtmlRenderer,reader=new stmd.DocParser;$(document).ready(function(){function e(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}var t=function(){var e=s("1234");e!=$("#tex").val()&&($("#tex").val(s("1234")),l())},n=function(e){$("#errors").css("display","block"),$("#alert").html("<strong>Error!</strong> "+e)},a=function(){$("#errors").css("display","none")},r=new Dropbox.Client({key:"7nj69doyzp49ge1"}),o=null;r.authenticate({interactive:!1},function(e){e&&(n("Unable to authenticate."),$("#dropbox-button").addClass("disabled"))});var d=function(){r.isAuthenticated()&&($("#dropbox").css("display","none"),$("#app").css("display","block"))};d(),$("#dropbox-button").click(function(){r.authenticate({},function(e){e&&(n("Unable to authenticate."),$("#dropbox-button").addClass("disabled")),d()})});var i=function(){console.log("Channels");var e=r.getDatastoreManager();e.openDefaultDatastore(function(e,a){e&&n("Unable to access data."),o=a,a.recordsChanged.addListener(function(){t()}),t()})};i();var c=function(e,t){if(null!==o){var n=o.getTable("notepads"),a=n.query({padname:e});if(a.length>0){var r=a[0];r.set("data",t)}else{n.insert({padname:e,data:t,created:new Date})}}},s=function(e){if(null===o)return"";var t=o.getTable("notepads"),n=t.query({padname:e});return n.length>0?n[0].get("data"):""},l=function(){a();var t=(document.getElementById("output"),$("#tex").val());c("1234",t),t=writer.renderBlock(reader.parse(t)).split("$");var r="",o=!1,d=!1;try{for(var i in t){if(""==t[i]&&(o=!o,d=!d),o){var s=katex.renderToString(e(t[i]));r+=d?'<div class="text-center">'+s+"</div>":s,d=!1}else r+=t[i];o=!o}$("#output").html(r)}catch(l){n(l.message)}};$("#tex").focus(),$("#render").click(l),$("#tex").bind("keydown","ctrl+return",l)});